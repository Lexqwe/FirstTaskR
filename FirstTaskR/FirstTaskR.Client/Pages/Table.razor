@page "/table"
@using Microsoft.AspNetCore.Components.Web
@using System.Net.Http.Json
@using Shared.Data.Tables
@using Shared.Data.UI
@using Radzen.Blazor
@rendermode InteractiveWebAssembly
@inject HttpClient httpClient

<h1>Object Types</h1>
@* 
@if (isLoading)
{
    <p>Load...</p>
}
else
{
    <table>
        <thead>
            <tr>
                <th>ID</th>
                <th>Name</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var Report in reports)
            {
                <tr>
                    <td>@Report.well</td>
                    <td>@Report.ngdu</td>
                </tr>
            }
        </tbody>
    </table>
} *@


<RadzenDropDown Data=@Years
                @bind-Value=@Month
                TValue="string"
                Placeholder="Выберите год"
                Change="@OnFilterChange" />

<RadzenDropDown Data=@Monthes
                @bind-Value=@Year
                TValue="string"
                Placeholder="Выберите месяц"
                Change="@OnFilterChange" />

@if (isLoading)
{
    <p>Load...</p>
}
else
{
    <RadzenDataGrid Data=@reports
                    TItem="Report"
                    AllowFiltering="true"
                    AllowPaging="true"
                    PageSize="30">
        <Columns>
            <RadzenDataGridColumn TItem="Report" Property="well" Title="Скважина" />
            <RadzenDataGridColumn TItem="Report" Property="ngdu" Title="НГДУ" />
            <RadzenDataGridColumn TItem="Report" Property="cdng" Title="ЦДНГ" />
        </Columns>
    </RadzenDataGrid>
}

@code {
    private List<Report> reports = new();
    private List<ObjectType> object_types = new();
    private List<Shared.Data.Tables.Object> objects = new();
    private List<Well> wells = new();
    private List<WellDayHistory> well_day_histories = new();
    private List<WellDayPlan> well_day_plans = new();

    bool isLoading = true; 
    private string Month { get; set; }
    private string Year { get; set; }

    private List<string> Years = new() { "2024", "2025", "2026" };
    private List<string> Monthes = new() { "Январь", "Февраль", "Март", "Апрель", "Май", "Июнь", "Июль", "Август", "Сентябрь", "Октябрь", "Ноябрь", "Декабрь" };

    protected override async Task OnInitializedAsync()
    {
        await LoadObjectTypes();
        await LoadObjects();
        await LoadWells();
        await LoadWellDayHistories();
        await LoadWellDayPlans();
        BuildReports();
        isLoading = false;
    }

    async Task LoadObjectTypes()
    {
        //object_types = await httpClient.GetFromJsonAsync<List<ObjectType>>("api/ObjectTypes");
        object_types = await httpClient.GetFromJsonAsync<List<ObjectType>>("https://localhost:7184/api/ObjectTypes");
    }

    async Task LoadObjects()
    {
        objects = await httpClient.GetFromJsonAsync<List<Shared.Data.Tables.Object>>("https://localhost:7184/api/Objects");
    }

    async Task LoadWells()
    {
        wells = await httpClient.GetFromJsonAsync<List<Well>>("https://localhost:7184/api/Wells");
    }

    async Task LoadWellDayHistories()
    {
        well_day_histories = await httpClient.GetFromJsonAsync<List<WellDayHistory>>("https://localhost:7184/api/WellDayHistories");
    }

    async Task LoadWellDayPlans()
    {
        well_day_plans = await httpClient.GetFromJsonAsync<List<WellDayPlan>>("https://localhost:7184/api/WellDayPlans");
    }

    public void BuildReports()
    {
        foreach(var item in wells)
        {
            Report NewReport = new();
            NewReport.well = objects.Single(o => o.id == item.well).name;
            NewReport.ngdu = objects.Single(o => o.id == item.ngdu).name;
            NewReport.cdng = objects.Single(o => o.id == item.cdng).name;
            reports.Add(NewReport);
        }
    }

    private void OnFilterChange()
    {

    }
}


@*         
в таблице надо будет вывести основную информацию  Месторождение, НГДУ, ЦДНГ и агрегированные данные - 1. 
Суммарный дебит 2. Средний дебит 3. Сумарное потребление э/энергии

агрегацию делать по месяцам с возможностью выбора месяца и года из выпадающего списка

выпадающий список над таблицей можно сделать

либо как тебе удобнее будет *@